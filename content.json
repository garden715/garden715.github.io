{"pages":[],"posts":[{"title":"Zabbix Centos 7 HA 구성","text":"1. root 접속 제한 (Optional)123vi /etc/ssh/sshd_config# PermitRootLogin nosystemctl restart sshd 2. 계정 생성 (Optional)그냥 리눅스에 ssh 접속 할 계정 하나 추가해 주기 12useradd [user name]passwd [user name] 3. sudoer 등록 (Optional)sudoer로 추가해주기. 편하니까 1visudo 4. 필요한 도구 설치zabbix server, httpd 설치한다.여기서는 DB(MYSQL)서버는 다른 서버로 구축해 연동해서 사용하는 걸로 1234567891011yum install httpdyum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpmyum install http://rpms.remirepo.net/enterprise/remi-release-7.rpmyum -y install yum-utilssubscription-manager repos --enable=rhel-7-server-optional-rpmsyum-config-manager --enable remi-php73yum-config-manager --disable remi-php54yum search php73 | moreyum install php73 php73-php php73-php-fpm php73-php-gd php73-php-json php73-php-mbstring php73-php-mysqlnd php73-php-xml php73-php-xmlrpc php73-php-opcache curl curl-devel php73-php-develsudo ln -s /usr/bin/php73 /usr/bin/php 5. Zabbix 설치1234yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agentvim /etc/zabbix/zabbix_server.confvim /etc/zabbix/zabbix_agentd.conf 6. 방화벽 허용 (두 서버 모두)클러스터로 동작할 두 서버간 통신을 허용해 준다.ha 서비스랑 웹, 자빅스 서버, 에이전트에서 사용할 Port 까지 추가해주고 reload 12345678910firewall-cmd --permanent --add-service=high-availability# successfirewall-cmd --permanent --add-service=http# successfirewall-cmd --permanent --add-port=10051/tcp# successfirewall-cmd --permanent --add-port=10050/tcp# successfirewall-cmd --reload# success 7. Hosts 파일 수정 (두 서버 모두)클러스터 등록할 IP/Server 잡아주고 1234vim /etc/hosts # 1.1.1.1 host1# 1.1.1.2 host1# 1.1.1.3 vip 8. Pacemaker 설치 (두 서버 모두)pacemaker, pcs 패키지 설치하기 1234yum install pacemaker pcspasswd hacluster #암호설정해주기 pcs깔면 hacluster라는 유저가 생기는데 여기 password 변경해줘야함systemctl start pcsdsystemctl enable pcsd 9. pcs 설정cluster에 member로 동작할 두 서버인증하기인증하는데 오류나면 대부분 둘간 통신문제로 방화벽을 제대로 열었나 확인해보자 1234567891011121314# 인증pcs cluster auth host1 host2#username: hacluster, password: 아까 설정한 password# 셋업하는 작업pcs cluster setup --name zabbix_cluster host1 host2pcs cluster start --allsystemctl enable corosyncsystemctl enable pacemaker# Cluster, Node 상태 확인해보기pcs status clusterpcs status nodes 10. 리소스 설정1234567891011121314#필요없는 세팅은 설정 없애고pcs property set stonith-enabled=falsepcs property set no-quorum-policy=ignore# 리소스 설정# ip=부분에 virtual ip 설정해주면 됨pcs resource create cluster_vip ocf:heartbeat:IPaddr2 ip=1.1.1.3 cidr_netmask=24 op monitor interval=20s# systemd 프로세스명으로 zabbix-server 설정해주기pcs resource create zabbix_server systemd:zabbix-server op monitor interval=10spcs constraint colocation add zabbix_server cluster_vip INFINITY# 리소스 순서 정하기pcs constraint order cluster_vip then zabbix_server","link":"/2020/06/25/ha-zabbix/"}],"tags":[{"name":"zabbix","slug":"zabbix","link":"/tags/zabbix/"},{"name":"ha","slug":"ha","link":"/tags/ha/"}],"categories":[]}